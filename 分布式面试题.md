什么是CAP理论
===

CAP定理，指的是在一个分布式系统中， 一致性、可用性和分区容错性 三者不可同时兼得。

- **Consistency (一致性)**：对一个节点的数据进行更新操作后，所有节点能够==马上==获取到最新的数据。

- **Availability (可用性)**：系统提供的服务必须一直处于可用的状态，对于用户的每一个操作请求都能够==及时的返回结果==。

- **Partition Tolerance (分区容错性)**：分布式系统在遇到某节点或网络分区故障的时候，==仍然==能够对外提供满足一致性和可用性的服务。

![image-20210721102052851](分布式面试题.assets/image-20210721102052851.png)

CA：放弃分区容错性P，加强一致性和可用性，其实就是传统的单机数据库的选择。 

AP：放弃一致性C，一旦分区发生，节点之间可能会失去联系，为了高可用，每个节点只能用本地数据提供服务，而这样会导致全局数据的不一致性。

CP：放弃可用性A，由于分区之间会导致同步时间无限延长(等待数据同步完才能正常访问服务)，一旦发生网络故障或者消息丢失等情况，就要牺牲用户的体验，等待所有数据全部一致了之后再让用户访问系统。最典型的就是分布式数据库，如Redis、HBase等



什么是BASE理论
===

BASE是**B**asically **A**vailable（基本可用）、**S**oft state（软状态）和**E**ventually consistent（最终一致性）的缩写，基于CAP定理逐步演化而来。

BASE理论的核心思想是：即使无法做到强一致性，但每个应用都可以根据自身业务特点，采用适当的方式来使系统达到**最终一致性**。

- 基本可用：分布式系统在出现不可预知故障的时候，允许损失部分可用性。比如时间上的损失，功能上的损失。

- 软状态：允许系统在不同节点的数据副本之间进行数据同步的过程存在延时。
- 最终一致性：最终一致性强调的是所有的数据副本，在经过一段时间的同步之后，最终都能够达到一个一致的状态。





分布式事务解决方案
===

两阶段提交(2PC)
---

在分布式系统中，为了让每个节点都能够感知到其他节点的事务执行状况，需要引入**一个中心节点**来统一处理所有节点的执行逻辑，这个中心节点叫做协调者，被中心节点调度的其他业务节点叫做参与者。

两阶段提交，顾名思义，2PC将分布式事务分成了两个阶段，两个阶段分别为**投票阶段** 和 **执行阶段**。

投票阶段：

- 协调者向所有参与者发送prepare请求与事务内容，询问是否可以准备事务提交，并等待参与者的响应。
- 参与者执行事务中包含的操作，并记录undo log（用于回滚）和redo log（用于重放），但不真正提交。
- 参与者向协调者返回事务操作的执行结果，执行成功返回yes，否则返回no

执行阶段：

- 若所有参与者都返回yes，说明事务可以提交。
  - 协调者向所有参与者发送commit请求。
  - 参与者收到commit请求后，将事务真正地提交上去，并释放占用的事务资源，并向协调者返回ack。
  - 协调者收到所有参与者的ack消息，事务成功完成
- 若有参与者返回no或者超时未返回，说明事务中断，需要回滚。



三阶段提交(3PC)
---





TCC补偿事务
---





本地消息队列表(MQ)
---





**数据一致性有哪几种模型**



mysql的二阶段提交

